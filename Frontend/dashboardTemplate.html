<!DOCTYPE html>
<html>
<head>
    <script src="jquery-3.4.1.min.js"></script>
    <meta charset="utf-8"/>
    <title>Dashboard</title>
    <style>
        .activities{
            display:block;
            margin-bottom: 8px;
            border-style: double;
            border-color: black;
            padding: 4px;
            padding-left: 10px;
        }
    </style>
</head>
<body>
<h1>Neue Aktivität hochladen</h1>
<form  enctype="multipart/form-data" action="uploadHandler" method="post">
    <label>Art der Aktivität:</label><br>
    <select name="activity" size="2" required="required">
        <option>Laufen</option>
        <option>Radfahren</option>
    </select><br><br>
    <label>Kommentare</label><br>
    <textarea name="kommentare" rows="10" cols="50"></textarea><br><br>
    <label>GPX_Datei zum hochladen auswählen:</label><br>
    <input name="datei" type="file" size="50" accept="" required="required"><br><br>
    <button>Hochladen</button>
</form>
<h1>Ihre Aktivitäten</h1>

<script>
    function remove(){
        var actID = $(event.target).parent().parent()[0].firstElementChild.textContent;
        $(event.target).parent().parent().remove();
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "POST", "/removeActivity");
        xmlHttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
        xmlHttp.send("actID="+actID);
        xmlHttp.responseType = 'blob';
    }
    function download(){
        var actID = $(event.target).parent().parent()[0].firstElementChild.textContent;
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "POST", "/downloadActivity");
        xmlHttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
        xmlHttp.responseType = 'blob';
        xmlHttp.onload = function () {
            var blob = this.response;
            //var contentDispo = this.getResponseHeader('Content-Disposition');
            //var fileName = contentDispo.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/)[1];
            saveBlob(blob, "File.gpx");
        }
        xmlHttp.send("actID="+actID);
    }
    function saveBlob(blob, fileName) {
        var a = document.createElement('a');
        a.href = window.URL.createObjectURL(blob);
        a.download = fileName;
        a.dispatchEvent(new MouseEvent('click'));
    }
    function edit(){
        var actID = $(event.target).parent().parent(0).children(0)[0];
        var actArt = $(event.target).parent().parent(0).children(0)[1];
        var comment = $(event.target).parent().parent(0).children(0)[2];
        var button = $(event.target);
        if (button[0].innerText=="speichern"){
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "POST", "/editActivity");
            xmlHttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xmlHttp.send("actID="+actID.innerText +"&actArt="+actArt.innerText+"&comment="+comment.innerText);

            actArt.setAttribute('contenteditable','false');
            comment.setAttribute('contenteditable','false');
            actArt.setAttribute('bgcolor','#FFFFFF');
            comment.setAttribute('bgcolor','#FFFFFF');

            button[0].innerText = "edit";

        }else{
            //make editable
            actArt.setAttribute('contenteditable','true');
            comment.setAttribute('contenteditable','true');
            actArt.setAttribute('bgcolor','#FF0000');
            comment.setAttribute('bgcolor','#FF0000');
            button[0].innerText = "speichern";
        }
    }
</script>
<form action="searchCommentHandler" method="post">
    <label>Suche eingeben:
    </label>
    <input name="searchField" type="text">
    <button name="Suche">Suchen</button>
</form>
<div style="padding-top: 20px">
    {{range .Activities}}
    <div class="activities">
        <h3>{{.Activityart}} am {{.Highspeedtime}}</h3>
        <table style="border-spacing:10px;">
            <tr>
                <td><b>Kommentar:</b> {{.Comment}}</td>
            </tr>
            <tr>
                <td><b>Gesamtdistanz:</b> {{.Distance}} km</td>
                <td><b>Standzeit:</b> {{.Standzeit}} s</td>
                <td>Schnellste Durchschnittsgeschwindigkeit von {{.AvgSpeedFastMS}} M/s am Kilometer {{.AvgSpeedFastKM}}</td>
            </tr>
            <tr>
                <td><b>Durschnittsgeschwindigkeit:</b> {{.Avgspeed}} M/s</td>
                <td><b>Höchstgeschwindigkeit:</b> {{.HighSpeed}} M/s</td>
                <td>Langsamste Durchschnittsgeschwindigkeit von {{.AvgSpeedSlowMS}} M/s am Kilometer {{.AvgSpeedSlowKM}}</td>

            </tr>
            <tr>
                <td><b>Datum:</b></td>
                <td><b>erreicht am Zeitpunkt:</b> {{.Highspeedtime}}</td>
                <td>ID: {{.ActID}}</td>
            </tr>
            <tr>
                <td><button onclick="edit()">Edit</button><button onclick="remove()">Delete</button><button onclick="download()">Download</button></td>
            </tr>
        </table>

    </div>
    {{end}}
</div>
<!---
<table>
  <tr>
    <th>ActivityID</th>
    <th>Art der Aktivität</th>
    <th>Kommentar</th>
    <th>Gesamtdistanz</th>
    <th>Standzeit</th>
	<th>Maximalgeschwindigkeit</th>
	<th>Maximalgeschwindigkeit am Zeitpunkt</th>
    <th>Durchschnittsgeschwindigkeit</th>
    <th>schnellster KM</th>
    <th>Durchschnittsgeschwindigkeit schnellster Kilometer</th>
    <th>langsamster KM</th>
    <th>Durchschnittsgeschwindigkeit langsamster Kilometer</th>

  </tr>
    {{range .Activities}}
    <tr>
        <td>{{.ActID}}</td>
        <td>{{.Activityart}}</td>
        <td>{{.Comment}}</td>
        <td>{{.Distance}} km</td>
        <td>{{.Standzeit}} s</td>
        <td>{{.HighSpeed}} M/s</td>
        <td>{{.Highspeedtime}}</td>
        <td>{{.Avgspeed}} M/s</td>
        <td>{{.AvgSpeedFastKM}}</td>
        <td>{{.AvgSpeedFastMS}} M/s</td>
        <td>{{.AvgSpeedSlowKM}}</td>
        <td>{{.AvgSpeedSlowMS}} M/s</td>
        <td><button onclick="edit()">Edit</button><button onclick="remove()">Delete</button><button onclick="download()">download</button></td>
    </tr>
    {{end}}
   <tr>
</table>
--->
</body>
</html>